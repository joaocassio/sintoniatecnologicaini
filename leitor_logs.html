<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classificação de Equipes</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 8px;
            text-align: left;
        }
    </style>
</head>
<body>

<h1>Upload de Arquivos e Classificação de Equipes</h1>
<p>Carregue os arquivos de log e veja a classificação das equipes com base nos pontos e kills.</p>

<input type="file" id="fileInput" multiple><br><br>
<button onclick="processFiles()">Enviar Arquivo</button>

<h2>Resultados</h2>
<table id="resultsTable">
    <thead>
        <tr>
            <th>Classificação</th>
            <th>Team Name</th>
            <th>Total Kill Score</th>
            <th>Total Points</th>
            <th>Primeiro Lugar (vezes)</th>
            <th>Segundo Lugar (vezes)</th>
            <th>Terceiro Lugar (vezes)</th>
        </tr>
    </thead>
    <tbody id="tableBody">
    </tbody>
</table>

<script>
    // Função para processar o upload e a leitura dos arquivos
    function processFiles() {
        const files = document.getElementById('fileInput').files;
        if (files.length === 0) {
            alert('Por favor, selecione um ou mais arquivos.');
            return;
        }

        const teamsData = {};

        Array.from(files).forEach(file => {
            const reader = new FileReader();
            reader.onload = function(event) {
                const text = event.target.result;
                processLogData(text, teamsData);
                updateTable(teamsData);
            };
            reader.readAsText(file);
        });
    }

    // Função para processar os dados do arquivo .log
    function processLogData(data, teamsData) {
        const teamRegex = /TeamName: (.+?)\s+Rank: (\d+)\s+KillScore: (\d+)\s+RankScore: \d+\s+TotalScore: \d+/g;
        let match;

        while ((match = teamRegex.exec(data)) !== null) {
            const teamName = match[1].trim();
            const rank = parseInt(match[2], 10);
            const killScore = parseInt(match[3], 10);

            if (!teamsData[teamName]) {
                teamsData[teamName] = {
                    totalKillScore: 0,
                    totalPoints: 0,
                    firstPlaceCount: 0,
                    secondPlaceCount: 0,
                    thirdPlaceCount: 0,
                };
            }

            // Soma as kills
            teamsData[teamName].totalKillScore += killScore;

            // Atribui pontos e conta a posição do time
            switch (rank) {
                case 1:
                    teamsData[teamName].totalPoints += 10; // 10 pontos para 1º lugar
                    teamsData[teamName].firstPlaceCount++;
                    break;
                case 2:
                    teamsData[teamName].totalPoints += 9; // 9 pontos para 2º lugar
                    teamsData[teamName].secondPlaceCount++;
                    break;
                case 3:
                    teamsData[teamName].totalPoints += 8; // 8 pontos para 3º lugar
                    teamsData[teamName].thirdPlaceCount++;
                    break;
                default:
                    teamsData[teamName].totalPoints += (11 - rank); // Pontos decrescentes para outras posições
                    break;
            }
        }
    }

    // Função para ordenar e atualizar a tabela com os dados das equipes
    function updateTable(teamsData) {
        const tableBody = document.getElementById('tableBody');
        tableBody.innerHTML = '';

        // Converte o objeto para um array e ordena por pontos e kills (critério de desempate)
        const sortedTeams = Object.keys(teamsData).map(teamName => {
            return { teamName, ...teamsData[teamName] };
        }).sort((a, b) => {
            if (b.totalPoints === a.totalPoints) {
                return b.totalKillScore - a.totalKillScore; // Desempate por kills
            }
            return b.totalPoints - a.totalPoints; // Ordenar por pontos
        });

        // Atualiza a tabela com os dados ordenados
        sortedTeams.forEach((team, index) => {
            const row = document.createElement('tr');

            const rankCell = document.createElement('td');
            rankCell.textContent = index + 1; // Classificação

            const teamNameCell = document.createElement('td');
            teamNameCell.textContent = team.teamName;

            const totalKillCell = document.createElement('td');
            totalKillCell.textContent = team.totalKillScore;

            const totalPointsCell = document.createElement('td');
            totalPointsCell.textContent = team.totalPoints;

            const firstPlaceCell = document.createElement('td');
            firstPlaceCell.textContent = team.firstPlaceCount;

            const secondPlaceCell = document.createElement('td');
            secondPlaceCell.textContent = team.secondPlaceCount;

            const thirdPlaceCell = document.createElement('td');
            thirdPlaceCell.textContent = team.thirdPlaceCount;

            row.appendChild(rankCell);
            row.appendChild(teamNameCell);
            row.appendChild(totalKillCell);
            row.appendChild(totalPointsCell);
            row.appendChild(firstPlaceCell);
            row.appendChild(secondPlaceCell);
            row.appendChild(thirdPlaceCell);
            
            tableBody.appendChild(row);
        });
    }
</script>

</body>
</html>

